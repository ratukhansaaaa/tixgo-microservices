version: "3.8"

services:
  identity:
    build:
      context: ./identity-service
    container_name: tixgo-identity
    env_file:
      - .env
    ports:
      - "18081:8000" # keep host port so BT can route subdomain -> STB:18081
    restart: unless-stopped
    networks:
      - tixgo-net

  attendance:
    build:
      context: ./attendance-service
    container_name: tixgo-attendance
    env_file:
      - .env
    ports:
      - "18082:8000" # keep host port so BT can route subdomain -> STB:18082
    restart: unless-stopped
    networks:
      - tixgo-net

  # Optional cloudflared service - usually the tunneling is handled by BT.
  # If you want to run the tunnel from the STB itself, uncomment and provide
  # credential file and config as described in cloudflared/config.yml.example.
  #cloudflared:
  #  image: cloudflare/cloudflared:latest
  #  container_name: cloudflared
  #  restart: unless-stopped
  #  volumes:
  #    - ./cloudflared/config.yml:/etc/cloudflared/config.yml:ro
  #    - ~/.cloudflared/<TUNNEL_ID>.json:/etc/cloudflared/<TUNNEL_ID>.json:ro
  #  command: tunnel run --config /etc/cloudflared/config.yml tixgo-tunnel
  #  networks:
  #    - tixgo-net

networks:
  tixgo-net:
    driver: bridge
